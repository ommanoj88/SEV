# Deep Dive: Real-time Tracking Analysis

**Date:** 2025-11-19
**Feature:** Real-time Vehicle Tracking
**Status:** üëª **Ghost Feature (Frontend Only)**

This report analyzes the implementation of the Real-time Tracking feature.

## 1. Executive Summary
**The feature does not exist.**

While the Frontend has a sophisticated Map component and a WebSocket client, the Backend **has zero WebSocket implementation**. The frontend is literally shouting into the void.

## 2. Frontend Analysis (`VehicleMap.tsx`, `websocket.ts`)
**Status:** ‚úÖ **Implemented (Client-side)**

*   **Map Component:** `VehicleMap.tsx` uses Mapbox GL to render vehicles. It supports updating markers dynamically.
*   **WebSocket Client:** `websocket.ts` uses `socket.io-client` to try and connect to a WebSocket server.
*   **Events:** It listens for:
    *   `LOCATION_UPDATE`
    *   `BATTERY_UPDATE`
    *   `VEHICLE_STATUS_UPDATE`

```typescript
// websocket.ts
this.socket = io(WS_URL, { ... }); // Tries to connect
this.socket.on(WS_EVENTS.LOCATION_UPDATE, (data) => { ... }); // Listens for updates
```

## 3. Backend Analysis (`evfleet-monolith`)
**Status:** ‚ùå **Completely Missing**

*   **No WebSocket Config:** A search for `WebSocket`, `Socket`, `Stomp`, or `Messaging` in the backend returned **0 results**.
*   **No Socket.IO:** The frontend uses `socket.io-client`, which requires a specific Socket.IO server implementation (usually Node.js, or `netty-socketio` in Java). This library is **not present** in the Java backend.
*   **No Event Loop:** There is no background thread or scheduler pushing updates to connected clients.

## 4. The "Teleportation" Problem (Revisited)
Since Real-time tracking doesn't work, the only way to update location is via the REST API:
`PUT /api/v1/vehicles/{id}/location`

As noted in the Trip Analysis:
1.  This is a **destructive update** (overwrites previous location).
2.  It has **no history** (you can't see where the car was 5 minutes ago).
3.  It allows **teleportation** (jumping from London to New York in 1 second).

## 5. Recommendations
To make this feature real, you have two options:

### Option A: Polling (Easiest)
*   **Frontend:** Delete `websocket.ts`. Use `setInterval` to call `GET /api/v1/vehicles` every 10 seconds.
*   **Backend:** No changes needed (uses existing REST API).
*   **Pros:** Simple, robust.
*   **Cons:** High server load, not truly "real-time".

### Option B: Implement WebSockets (Best)
*   **Backend:** Add `spring-boot-starter-websocket`. Implement a `WebSocketHandler`.
*   **Frontend:** Switch from `socket.io-client` to `@stomp/stompjs` (standard for Spring Boot) OR implement `netty-socketio` in Java to keep the frontend as-is.
*   **Pros:** True real-time, efficient.
*   **Cons:** Complex to implement and scale.

## Summary
Real-time tracking is currently a UI illusion. The map will never move unless you refresh the page, because the backend has no way to push updates to the browser.
