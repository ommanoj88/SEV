# Deep Dive: TCO (Total Cost of Ownership) Analysis

**Date:** 2025-11-19
**Feature:** TCO (Total Cost of Ownership)
**Status:** üëª Ghost Feature

## 1. Executive Summary
TCO Analysis is a **Ghost Feature** with a sophisticated frontend UI showing EV vs ICE cost comparisons, 5-year projections, ROI calculations, and CO‚ÇÇ savings. However, the backend API endpoint does not exist, and all calculations are performed client-side using hardcoded constants and mock data. There is no TCO entity, no database storage, and no real TCO calculation engine.

## 2. Backend Analysis
**Status:** ‚ùå Missing

*   **Entities:**
    *   None - No `TCOAnalysis` entity exists
    *   No database table for TCO data
    *   No migration files for TCO tracking
    *   FleetSummary has basic cost fields but no TCO-specific fields (purchase price, depreciation, resale value, etc.)

*   **Logic:**
    *   **Service Layer:** No TCO calculation methods in `AnalyticsService.java`
    *   **Controller Layer:** `AnalyticsController.java` does NOT have:
        *   `/api/v1/analytics/tco-analysis/{vehicleId}` endpoint (expected by frontend)
    *   **No TCO Formula:** Backend has no implementation of:
        *   Purchase Price + Operating Costs + Maintenance + Insurance + Depreciation - Resale Value
        *   Comparison logic between EV and ICE vehicles
        *   Payback period calculation
        *   ROI calculation
        *   CO‚ÇÇ savings calculation

*   **Missing:**
    *   Complete backend implementation
    *   TCO calculation engine
    *   Database schema to store:
        *   Vehicle purchase price
        *   Depreciation schedules
        *   Estimated resale values
        *   Insurance costs (separate from operational costs)
        *   Loan/lease details (interest, payments)
        *   Government incentives/rebates
    *   Integration with actual cost data from:
        *   Charging module (energy costs)
        *   Maintenance module (maintenance costs)
        *   Fleet module (purchase price, depreciation)
    *   API endpoint to serve calculated TCO data
    *   Comparison baseline data for ICE vehicles

## 3. Frontend Analysis
**Status:** üëª UI Only (Sophisticated Ghost Implementation)

*   **Components:**
    *   `TCOAnalysis.tsx` - Comprehensive component (398 lines) with:
        *   Key metrics cards (Total Savings, ROI, Payback Period, CO‚ÇÇ Savings)
        *   Cost comparison bar chart (EV vs ICE)
        *   Cost breakdown pie chart
        *   5-year cumulative cost projection area chart
        *   Key insights section
    *   Located at `frontend/src/components/analytics/TCOAnalysis.tsx`
    
*   **Integration:**
    *   **Redux Integration:** `analyticsSlice.ts` has `fetchTCOAnalysis` async thunk
    *   **API Call Attempted:** `analyticsService.getTCOAnalysis(vehicleId)` ‚Üí `/api/v1/analytics/tco-analysis/{vehicleId}` (404)
    *   **Hardcoded Constants:**
        ```javascript
        ICE_VEHICLE_CONSTANTS = {
          PURCHASE_PRICE: 35000,
          FUEL_COSTS_5YR: 15000,
          MAINTENANCE_COSTS_5YR: 8000,
          INSURANCE_COSTS_5YR: 2000
        }
        ```
    *   **Client-Side Calculations:**
        *   Total Savings = (ICE Total) - (EV Total) = $12,500 (hardcoded in fallback)
        *   ROI = (totalSavings / totalCost) * 100 = 23.1% (calculated from mock data)
        *   Payback Period = 36 months (hardcoded)
        *   CO‚ÇÇ Savings = (totalSavings / 500) * 0.3 (simplified formula)
    *   **Mock Data:** All data derived from hardcoded constants or `tcoAnalysis` state (which is null)
    *   **No Real API Integration:** When API fails (always), uses calculated values from constants

## 4. Impact
**Business Impact:**
*   **Critical Decision-Making Gap:** Fleet managers cannot make real TCO-based purchasing decisions
*   **Invalid Comparisons:** EV vs ICE comparison is based on generic constants, not actual fleet data
*   **No Vehicle-Specific TCO:** Cannot calculate TCO for specific vehicle models or usage patterns
*   **Financial Planning Impossible:** Cannot forecast actual ownership costs
*   **Inaccurate ROI:** Displayed ROI is not based on real financial data

**Technical Impact:**
*   Sophisticated UI gives false impression of a working feature
*   Frontend calculates with generic constants instead of real data
*   No integration with actual cost tracking from other modules
*   API endpoint doesn't exist, causing 404 errors
*   CO‚ÇÇ calculation formula is oversimplified

## 5. Recommendations
1.  **Create TCO Entity and Schema:**
    ```java
    @Entity
    class VehicleTCO {
      vehicleId, purchasePrice, purchaseDate,
      governmentIncentives, depreciationRate,
      estimatedResaleValue, loanAmount, interestRate,
      expectedLifespanYears, expectedMileage
    }
    ```
2.  **Implement TCO Calculation Engine:**
    *   **Acquisition Costs:** Purchase price - incentives + taxes/fees
    *   **Operating Costs:** Sum of energy/fuel costs from actual data
    *   **Maintenance Costs:** Sum from maintenance records
    *   **Insurance Costs:** From fixed costs table
    *   **Depreciation:** Calculate based on age, mileage, condition
    *   **Financing Costs:** Calculate interest on loans/leases
    *   **Resale Value:** Estimate based on depreciation curve
    *   **Total TCO Formula:** Acquisition + Operating + Maintenance + Insurance + Financing - Resale Value
3.  **Add Comparison Logic:**
    *   Store ICE baseline data for different vehicle classes (sedan, SUV, truck)
    *   Calculate actual savings based on real EV data vs ICE baseline
    *   Calculate payback period: (EV Purchase Premium) / (Annual Operating Savings)
    *   Calculate ROI: (Total Savings / Total Investment) * 100
4.  **Implement API Endpoint:**
    *   `GET /api/v1/analytics/tco-analysis/{vehicleId}`
    *   Return: purchasePrice, operatingCosts, maintenanceCosts, insuranceCosts, totalCost, comparisonWithICE (totalSavings, paybackPeriod), roi, projections (5-year breakdown)
5.  **Integrate with Existing Modules:**
    *   Pull energy costs from Charging module
    *   Pull maintenance costs from Maintenance module
    *   Pull vehicle details from Fleet module (purchase price, date)
6.  **Add CO‚ÇÇ Calculation:**
    *   Use proper emissions factors (kg CO‚ÇÇ/kWh for electricity, kg CO‚ÇÇ/liter for fuel)
    *   Calculate actual emissions avoided based on distance traveled
    *   Consider grid electricity source (renewable vs fossil fuel)
7.  **Support Multiple Scenarios:**
    *   Allow comparing different vehicle models
    *   Support different usage patterns (high mileage, low mileage)
    *   Include sensitivity analysis (fuel price changes, electricity rate changes)
