# Deep Dive: Service History Analysis

**Date:** 2025-11-19
**Feature:** Service History Tracking
**Status:** ⚠️ **Basic Log / Missing Details**

This report analyzes the implementation of Service History Tracking.

## 1. Executive Summary
Service History is implemented as a filtered view of the `MaintenanceRecord` entity. While it successfully tracks *when* and *what* type of service occurred, it lacks the depth required for fleet auditing. There is no support for **Line Items** (breakdown of parts vs. labor) and no ability to store **Attachments** (invoices, photos).

## 2. Backend Analysis (`MaintenanceRecord`)
**Status:** ⚠️ **Shallow Data Model**

*   **Single Cost Field:**
    *   `private BigDecimal cost;`
    *   **Issue:** Cannot distinguish between Parts, Labor, and Tax.
    *   **Impact:** Cannot analyze if labor costs are rising or if specific parts are too expensive.
*   **No Attachments:**
    *   No `fileUrl` or `attachments` list.
    *   **Impact:** Cannot store the actual invoice or photos of the repair.
*   **No Parts Tracking:**
    *   Cannot track which specific parts (e.g., "Brake Pad Model X") were installed.

## 3. Frontend Analysis (`ServiceHistory.tsx`)
**Status:** ✅ **Functional Table**

*   **Display:** Shows Date, Vehicle, Type, Description, Provider, Cost, and Status.
*   **Filtering:** The component currently displays *all* records (from Redux state), relying on the backend or parent component to filter.
*   **Missing:** No "View Details" modal to see the breakdown (because the breakdown doesn't exist).

## 4. Impact
*   **Audit Failure:** If a mechanic overcharges for labor, the system hides it in a single "Cost" figure.
*   **Warranty Claims:** Without storing the invoice/receipt, claiming warranty on parts is difficult.
*   **Cost Analysis:** Cannot perform granular cost analysis (e.g., "How much did we spend on Tires vs. Oil?").

## 5. Recommendations

### 1. Add Line Items
*   Create `MaintenanceLineItem` entity (`description`, `quantity`, `unitPrice`, `type` [PART/LABOR]).
*   Link `OneToMany` from `MaintenanceRecord`.

### 2. Add Attachments
*   Add `List<String> attachmentUrls` to `MaintenanceRecord`.
*   Integrate with S3/Blob Storage for invoice uploads.

### 3. Enhanced Reporting
*   Update `ServiceHistory` to allow expanding a row to see line items and download invoices.

## Summary
The current Service History is a "Summary View". A true fleet system needs a "Detailed Ledger".
