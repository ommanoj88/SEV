# Deep Dive: Energy Consumption Tracking Analysis

**Date:** 2025-11-19
**Feature:** Energy Consumption Tracking
**Status:** üëª Ghost Feature

## 1. Executive Summary
Energy Consumption Tracking is a **Ghost Feature**. The frontend has complete UI components showing energy trends, efficiency metrics, and cost analysis. However, the backend API endpoint does not exist. The feature relies entirely on mock data in the frontend Redux slice. Importantly, the system does NOT separate EV energy from ICE fuel - there's no multi-fuel type distinction in the energy tracking logic.

## 2. Backend Analysis
**Status:** ‚ùå Missing

*   **Entities:**
    *   `FleetSummary` has `totalEnergyConsumed` (BigDecimal) field
    *   However, it's a single aggregated value with no separation of:
        *   Electric energy (kWh) for EVs
        *   Fuel consumption (liters/gallons) for ICE vehicles
        *   Different energy types or fuel grades
    *   No dedicated `EnergyConsumption` entity for detailed tracking
    *   No database table for time-series energy data

*   **Logic:**
    *   **Service Layer:** No energy-specific methods in `AnalyticsService.java`
    *   **Controller Layer:** `AnalyticsController.java` does NOT have:
        *   `/api/v1/analytics/energy-consumption` endpoint (expected by frontend)
    *   **No Fuel Type Separation:** 
        *   Backend does not distinguish between EV and ICE energy consumption
        *   FleetSummary stores only `totalEnergyConsumed` without type context
        *   No `fuelType` or `energyType` field in any entity
    *   **Integration with Charging Module:**
        *   `ChargingEventListener` receives energy data but only logs it
        *   Does not update `totalEnergyConsumed` in FleetSummary
        *   No time-series storage of charging events for analytics
    *   **No Integration with Fuel Module:**
        *   No listener or service to track ICE fuel consumption
        *   Cannot answer: "How much diesel vs electricity was consumed this month?"

*   **Missing:**
    *   Complete backend API endpoint
    *   Database schema for:
        *   Time-series energy consumption (date, vehicleId, energyType, amount, cost)
        *   Efficiency metrics (kWh/km, liters/100km)
        *   Energy source breakdown (grid electricity, solar, diesel, petrol)
    *   Multi-fuel type support:
        *   EV energy (kWh)
        *   ICE fuel types (diesel, petrol, CNG) with appropriate units
        *   Hybrid vehicle support
    *   Calculation logic for:
        *   Energy efficiency (distance per unit of energy)
        *   Cost per unit distance
        *   Trend analysis (daily, weekly, monthly)
        *   Comparison across vehicles
    *   Integration with actual charging sessions and fuel purchases

## 3. Frontend Analysis
**Status:** üëª UI Only (Ghost Implementation)

*   **Components:**
    *   **Redux Slice** (`analyticsSlice.ts`):
        *   `fetchEnergyConsumption` async thunk
        *   `MOCK_ENERGY_CONSUMPTION` array with sample data:
            ```javascript
            {
              date: '2025-10-28',
              energyConsumed: 120.5,
              distance: 450,
              efficiency: 26.8,
              chargingCost: 1446
            }
            ```
    *   **Service Layer** (`analyticsService.ts`):
        *   `getEnergyConsumption()` ‚Üí calls `/api/v1/analytics/energy-consumption`
    
*   **Integration:**
    *   **API Call Fails:** Endpoint returns 404
    *   **Falls Back to Mock:** Uses `MOCK_ENERGY_CONSUMPTION` when API fails
    *   **Mock Data:** Shows 3 days of energy data (Oct 28-30, 2025)
    *   **No Fuel Type UI:** Frontend doesn't distinguish between EV and ICE energy either
    *   **Efficiency Calculation:** Mock data shows `efficiency` field but no indication of unit (km/kWh? mpg?)

## 4. Impact
**Business Impact:**
*   **No Energy Optimization:** Cannot identify inefficient vehicles or drivers
*   **Cost Analysis Incomplete:** Cannot correlate energy costs with usage patterns
*   **Multi-Fuel Fleets Unsupported:** Mixed EV/ICE fleets cannot track both energy types
*   **No Trend Analysis:** Cannot see if energy consumption is increasing or decreasing
*   **Efficiency Monitoring Impossible:** Cannot track energy efficiency improvements over time
*   **Cannot Answer Key Questions:**
    *   "How much electricity did we use this month?"
    *   "Which vehicles are most energy-efficient?"
    *   "What's our cost per kilometer for energy?"
    *   "Are we saving money by switching to EVs?" (no fuel comparison)

**Technical Impact:**
*   Frontend makes failing API calls
*   No real data source for energy analytics
*   Charging session data is not aggregated for analytics
*   No support for multi-fuel type tracking despite being an EV fleet system

## 5. Recommendations
1.  **Create EnergyConsumption Entity:**
    ```java
    @Entity
    class EnergyConsumption {
      id, vehicleId, date, 
      energyType (ELECTRIC, DIESEL, PETROL, CNG),
      amountConsumed, unit (KWH, LITERS, GALLONS),
      distance, efficiency, cost
    }
    ```
2.  **Implement API Endpoint:**
    *   `GET /api/v1/analytics/energy-consumption?companyId={id}&startDate={date}&endDate={date}&vehicleId={id}&energyType={type}`
    *   Return array of energy consumption records with aggregation options
3.  **Add Multi-Fuel Type Support:**
    *   Track EV energy separately from ICE fuel
    *   Support different units (kWh for EVs, liters for diesel/petrol)
    *   Calculate separate efficiency metrics (km/kWh for EV, liters/100km for ICE)
    *   Enable side-by-side comparison of energy costs
4.  **Integrate with Charging Module:**
    *   Update `ChargingEventListener` to:
        *   Create `EnergyConsumption` record for each charging session
        *   Store: energyConsumed, cost, efficiency (if distance data available)
    *   Aggregate charging session data for analytics
5.  **Add Fuel Purchase Tracking:**
    *   Create API to record ICE fuel purchases (amount, cost, odometer reading)
    *   Create event listener for fuel purchase events
    *   Store in same `EnergyConsumption` table with energyType = DIESEL/PETROL
6.  **Implement Efficiency Calculations:**
    *   For EVs: efficiency = distance / energyConsumed (km/kWh)
    *   For ICE: efficiency = (fuelConsumed / distance) * 100 (liters/100km)
    *   Track efficiency trends over time
    *   Compare efficiency across vehicles and drivers
7.  **Add Reporting Features:**
    *   Daily/weekly/monthly energy consumption reports
    *   Energy cost breakdown by vehicle
    *   Efficiency leaderboard
    *   Alerts for unusual energy consumption patterns
8.  **Support Energy Source Tracking:**
    *   For EVs, track grid vs solar vs other renewable sources
    *   Calculate actual CO‚ÇÇ emissions based on energy source
    *   Enable sustainability reporting
