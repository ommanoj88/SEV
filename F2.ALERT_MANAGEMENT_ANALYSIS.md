# Deep Dive: Alert Management Analysis

**Date:** 2025-11-19
**Feature:** Alert Management
**Status:** ðŸ‘» Ghost Feature

## 1. Executive Summary
Alert Management is a **Ghost Feature**. While the notification system can store and display alerts (using the `type` field), there is NO rule-based alert configuration system. Users cannot create custom alert rules like "Alert me if SoC < 20%" or "Notify when vehicle enters geofence." All alerts are hardcoded in event listeners. There's no `AlertRule` entity, no alert configuration UI, and no dynamic alert engine.

## 2. Backend Analysis
**Status:** âŒ Missing (Alert Rules & Configuration)

*   **Entities:**
    *   **Reuses `Notification` entity** with type = ALERT
    *   **No `AlertRule` entity** for user-configurable rules
    *   **No `AlertConfiguration` entity** for alert settings
    *   No database table for:
        *   Alert rule definitions
        *   Alert conditions (threshold, comparison operators)
        *   Alert recipients
        *   Alert channels (in-app, email, SMS)

*   **Logic:**
    *   **Hardcoded Alerts Only:**
        *   `FleetEventListener.handleBatteryLow()` creates low battery alert
        *   Hardcoded threshold - cannot be configured by user
        *   Only triggers for battery events - no other alert types
    *   **Service Layer:** No `AlertManagementService` or `AlertRuleService`
    *   **Controller Layer:** 
        *   `NotificationController` has placeholder endpoints:
            *   `GET /api/v1/notifications/alerts` - Returns empty list
            *   `GET /api/v1/notifications/alerts/{priority}` - Returns empty list
        *   No endpoints for:
            *   Creating alert rules
            *   Updating alert rules
            *   Deleting alert rules
            *   Listing alert rules
            *   Testing alert rules
    *   **No Alert Engine:**
        *   No mechanism to evaluate conditions against real-time data
        *   No scheduler to check conditions periodically
        *   No rule evaluation logic (e.g., "if batteryLevel < threshold then alert")
        *   No support for complex conditions (AND, OR, NOT)
    *   **No Alert Configuration:**
        *   Cannot set alert recipients
        *   Cannot set alert channels (in-app only currently)
        *   Cannot set alert frequency (immediate, daily digest, etc.)
        *   Cannot set alert priority levels
        *   Cannot mute/unmute alerts

*   **Missing:**
    *   Complete alert rule management system
    *   Database schema for alert rules:
        ```java
        @Entity
        class AlertRule {
          id, userId, name, description, enabled,
          triggerType (BATTERY_LOW, GEOFENCE_EXIT, MAINTENANCE_DUE, etc.),
          conditions (JSON: field, operator, value),
          priority (LOW, MEDIUM, HIGH, CRITICAL),
          channels (IN_APP, EMAIL, SMS),
          recipients (user IDs or emails),
          cooldownMinutes (prevent spam)
        }
        ```
    *   Alert rule evaluation engine
    *   API endpoints for CRUD operations on alert rules
    *   Integration with real-time data sources (telematics, charging, etc.)
    *   Alert scheduling for non-real-time checks

## 3. Frontend Analysis
**Status:** ðŸ‘» No UI for Alert Configuration

*   **Components:**
    *   **Redux Slice** (`notificationSlice.ts`):
        *   Has `fetchAlerts` async thunk
        *   `MOCK_ALERTS` with sample critical battery alert
        *   No alert rule management actions
    *   **Service Layer** (`notificationService.ts`):
        *   `getHighPriorityAlerts()` - Calls backend (returns empty)
        *   No methods for:
            *   Creating alert rules
            *   Updating alert rules
            *   Deleting alert rules
    *   **No UI Components Found:**
        *   No "Alert Settings" page
        *   No "Create Alert Rule" dialog
        *   No "Manage Alerts" interface
    
*   **Integration:**
    *   Can display alerts that exist (from notifications)
    *   Cannot create or manage alert rules
    *   No threshold configuration UI
    *   No condition builder UI

## 4. Impact
**Business Impact:**
*   **No Proactive Monitoring:** Users cannot set up custom alerts for their specific needs
*   **Limited Alert Types:** Only battery low alerts exist, hardcoded
*   **Cannot Prevent Issues:** Cannot set alerts for preventive maintenance, upcoming inspections, etc.
*   **No Customization:** Fleet managers have different needs but cannot configure alerts
*   **Missed Critical Events:** Important events may occur without notification because no rule exists
*   **Cannot Scale:** Adding new alert types requires code changes, not configuration

**Technical Impact:**
*   All alerts are hardcoded in event listeners
*   No separation between alert logic and business logic
*   Cannot add new alert types without deploying code
*   No user control over alert behavior

## 5. Recommendations
1.  **Create Alert Rule Management System:**
    *   Design `AlertRule` entity with flexible condition structure
    *   Support multiple trigger types:
        *   Battery events (SoC < threshold, SoH < threshold)
        *   Location events (geofence entry/exit, route deviation)
        *   Maintenance events (due soon, overdue)
        *   Cost events (cost exceeds budget)
        *   Usage events (idle time > threshold, excessive speed)
        *   Charging events (charging failure, slow charging)
2.  **Implement Alert Rule Engine:**
    *   Create `AlertRuleEvaluator` service
    *   Support condition operators: <, >, <=, >=, ==, !=, IN, BETWEEN
    *   Support logical operators: AND, OR, NOT
    *   Support composite conditions
    *   Example rule definition:
        ```json
        {
          "name": "Low Battery Alert",
          "triggerType": "BATTERY_LEVEL",
          "conditions": [
            {"field": "batteryLevel", "operator": "<", "value": 20}
          ],
          "priority": "HIGH",
          "channels": ["IN_APP", "EMAIL"]
        }
        ```
3.  **Add API Endpoints:**
    *   `POST /api/v1/alerts/rules` - Create alert rule
    *   `GET /api/v1/alerts/rules` - List user's alert rules
    *   `GET /api/v1/alerts/rules/{id}` - Get rule details
    *   `PUT /api/v1/alerts/rules/{id}` - Update alert rule
    *   `DELETE /api/v1/alerts/rules/{id}` - Delete alert rule
    *   `POST /api/v1/alerts/rules/{id}/test` - Test rule with sample data
    *   `PUT /api/v1/alerts/rules/{id}/enable` - Enable/disable rule
4.  **Implement Real-Time Alert Evaluation:**
    *   Listen to all relevant events (battery updates, location updates, etc.)
    *   Evaluate active alert rules against incoming data
    *   Create notifications when conditions are met
    *   Respect cooldown periods to prevent spam
5.  **Add Alert Configuration UI:**
    *   "Alert Rules" page listing all configured rules
    *   "Create Alert Rule" wizard:
        *   Select trigger type (dropdown)
        *   Configure conditions (visual condition builder)
        *   Set priority and channels
        *   Set recipients
        *   Preview rule
    *   Enable/disable toggle for each rule
    *   Test button to validate rule
    *   Edit and delete options
6.  **Implement Alert Templates:**
    *   Pre-built alert rules for common scenarios:
        *   "Low Battery Alert (< 20%)"
        *   "Maintenance Due Soon"
        *   "Vehicle Left Service Area"
        *   "Excessive Idle Time"
    *   One-click activation of templates
    *   Customize after activation
7.  **Add Alert Grouping:**
    *   Group multiple vehicles in single alert (e.g., "3 vehicles have low battery")
    *   Support fleet-wide alerts vs vehicle-specific alerts
    *   Reduce alert fatigue
8.  **Implement Alert Analytics:**
    *   Track alert frequency
    *   Identify most common alerts
    *   Show alert response times
    *   Alert effectiveness metrics
9.  **Add Alert Scheduling:**
    *   Support time-based rules (e.g., "Alert if vehicle not used by 9 AM")
    *   Periodic checks for non-real-time conditions
    *   Scheduled maintenance reminders
10. **Support Multi-Channel Alerts:**
    *   In-app notifications (already working)
    *   Email notifications (needs implementation - see F4)
    *   SMS notifications (needs implementation - see F5)
    *   Webhook/API callbacks for integrations
